{
  "workflow_name": "UCSF H&E-iQID Co-registration",
  "version": "2.0.0",
  "description": "Configuration for H&E histology and iQID co-registration workflow - Updated for real UCSF data structure",
  
  "data_paths": {
    "base_path": "/home/wxc151/data/UCSF-Collab/data/",
    "readonly_warning": "CRITICAL: All UCSF data paths are READ-ONLY. No files will be written to these directories!",
    "datapush1": {
      "description": "Contains aligned iQID and H&E data",
      "base_path": "DataPush1/",
      "he_images": {
        "3d_scans": "DataPush1/HE/3D/",
        "sequential_10um": "DataPush1/HE/Sequential sections (10um)/"
      },
      "iqid_images": {
        "3d_scans": "DataPush1/iQID/3D/",
        "sequential_10um": "DataPush1/iQID/Sequential sections/"
      }
    },
    "reupload": {
      "description": "Contains iQID raw, segmented, and manually aligned data",  
      "base_path": "ReUpload/",
      "iqid_reupload": {
        "3d_scans": "ReUpload/iQID_reupload/3D/",
        "sequential_scans": "ReUpload/iQID_reupload/Sequential scans/"
      },
      "file_structure": {
        "raw_data": "0_*_iqid_event_image.tif",
        "segmented": "1_segmented/mBq_X.tif",
        "aligned": "2_aligned/mBq_corr_X.tif",
        "lr_images": "LR_ims/mBq_X.tif",
        "visualization": "Visualization/testAnimation_iQID.gif"
      }
    },
    "visualization": {
      "description": "Contains visualization results and animations",
      "base_path": "Visualization/",
      "animations": {
        "combined": "testAnimation_both.gif",
        "he_only": "testAnimation_HE.gif", 
        "iqid_full": "testAnimation_iQID_full.gif"
      }
    },
    "metadata": {
      "iqid_data": "iqid_data.txt",
      "readme": "readme.docx",
      "metadata_tju": "metadata_TJU.csv",
      "quantitative_notes": "quantitative_notes.docx"
    },
    "file_patterns": {
      "he_images": {
        "standard": "*.jpg",
        "tiff": "*.tif", 
        "png": "*.png",
        "sequential": "*_Lower_*.tif, *_Upper_*.tif"
      },
      "iqid_aligned": "mBq_corr_*.tif",
      "iqid_raw": "0_*_iqid_event_image.tif"
    },
    "tissue_types": ["Kidney", "Tumor"],
    "sample_structure": {
      "kidney_pattern": "D*M*(P*)_[LR]",
      "tumor_pattern": "D* M* tumor *um",
      "day_pattern": "D[0-9]+",
      "mouse_pattern": "M[0-9]+"
    }
  },
  
  "storage_policy": {
    "note": "All processing results are stored in local workflow directories",
    "readonly_sources": "UCSF data directories are read-only - no files written there",
    "intermediate_storage": "intermediate/ directory for temporary processing files",
    "output_storage": "outputs/ directory for final results",
    "log_storage": "logs/ directory for processing logs",
    "report_storage": "reports/ directory for analysis reports"
  },
  
  "he_preprocessing": {
    "stain_normalization": true,
    "normalization_method": "macenko",
    "artifact_removal": true,
    "resolution_matching": true,
    "target_resolution_um": 10.0,
    "enhance_contrast": true,
    "contrast_method": "clahe",
    "denoising": true,
    "denoising_method": "bilateral"
  },
  
  "registration": {
    "method": "feature_based",
    "initial_scale_factor": 1.0,
    "max_iterations": 200,
    "convergence_threshold": 1e-5,
    "use_mutual_information": true,
    "feature_detector": "SIFT",
    "max_features": 1000,
    "matching_ratio": 0.75,
    "ransac_threshold": 5.0,
    "transformation_type": "affine"
  },
  
  "segmentation": {
    "tissue_segmentation_method": "otsu",
    "activity_segmentation_method": "adaptive",
    "min_tissue_area": 500,
    "min_activity_area": 100,
    "morphological_operations": true,
    "closing_radius": 5,
    "opening_radius": 3,
    "watershed_segmentation": true,
    "watershed_markers": "local_maxima"
  },
  
  "analysis": {
    "quantify_activity_per_tissue": true,
    "calculate_dose_metrics": true,
    "statistical_analysis": true,
    "roi_analysis": true,
    "dose_conversion_factor": 1.0,
    "activity_units": "counts",
    "dose_units": "Gy",
    "calculate_heterogeneity": true,
    "heterogeneity_metrics": ["coefficient_of_variation", "entropy"]
  },
  
  "visualization": {
    "create_overlay_images": true,
    "create_analysis_plots": true,
    "save_segmentation_masks": true,
    "colormap_iqid": "viridis",
    "colormap_he": "gray",
    "colormap_overlay": "jet",
    "transparency_overlay": 0.6,
    "figure_dpi": 300,
    "figure_format": "png",
    "create_summary_figure": true
  },
  
  "output": {
    "base_output_dir": "outputs/he_iqid_coregistration/",
    "intermediate_dir": "intermediate/he_iqid/",
    "logs_dir": "logs/",
    "reports_dir": "reports/",
    "readonly_policy": "All outputs written outside readonly UCSF data directory",
    "save_registered_images": true,
    "save_segmentation_results": true,
    "save_quantitative_data": true,
    "export_csv": true,
    "export_excel": false,
    "output_format": "tiff",
    "compression": false,
    "create_report": true,
    "report_format": "json",
    "create_sample_subdirs": true,
    "preserve_sample_names": true
  },
  
  "quality_control": {
    "registration_correlation_threshold": 0.5,
    "tissue_coverage_minimum": 0.1,
    "activity_signal_to_noise": 2.0,
    "enable_manual_review_flags": true
  },
  
  "performance": {
    "use_gpu_acceleration": false,
    "memory_efficient_mode": true,
    "chunk_processing": true,
    "chunk_size_mb": 100
  },
  
  "logging": {
    "level": "INFO",
    "save_log": true,
    "log_file": "logs/he_iqid_coregistration.log",
    "detailed_timing": true,
    "create_timestamped_logs": true
  }
}
