{
  "workflow_name": "UCSF Unified iQID-H&E Analysis",
  "version": "2.0.0",
  "description": "Unified configuration for both iQID alignment and H&E co-registration workflows - Updated for real UCSF data structure",
  
  "workflows": {
    "iqid_alignment": {
      "enabled": true,
      "description": "iQID raw data alignment workflow"
    },
    "he_iqid_coregistration": {
      "enabled": true,
      "description": "H&E histology and iQID co-registration workflow"
    }
  },
  
  "data_paths": {
    "base_path": "/home/wxc151/data/UCSF-Collab/data/",
    "readonly_warning": "CRITICAL: All UCSF data paths are READ-ONLY. No files will be written to these directories!",
    
    "datapush1": {
      "description": "Contains processed/aligned iQID and H&E data",
      "he": {
        "base_path": "DataPush1/HE/",
        "3d_scans": "DataPush1/HE/3D/",
        "sequential_sections": "DataPush1/HE/Sequential sections (10um)/"
      },
      "iqid": {
        "base_path": "DataPush1/iQID/",
        "3d_scans": "DataPush1/iQID/3D/",
        "sequential_sections": "DataPush1/iQID/Sequential sections/"
      }
    },
    
    "reupload": {
      "description": "Contains raw, segmented, and aligned iQID data",  
      "iqid": {
        "base_path": "ReUpload/iQID_reupload/iQID/",
        "3d_scans": "ReUpload/iQID_reupload/iQID/3D/",
        "sequential_scans": "ReUpload/iQID_reupload/iQID/Sequential scans/"
      }
    },
    
    "sample_matching": {
      "he_sample_pattern": "D(\\d+)M(\\d+)_([LR])",
      "iqid_sample_pattern": "D(\\d+)M(\\d+)(?:\\(P\\d+\\))?_([LR])",
      "tissue_types": ["kidney", "tumor"],
      "scan_types": {
        "he": ["3D", "Sequential sections (10um)"],
        "iqid_datapush1": ["3D", "Sequential sections"],
        "iqid_reupload": ["3D", "Sequential scans"]
      }
    },
    
    "visualization": {
      "description": "Contains visualization results and animations",
      "base_path": "Visualization/",
      "animations": {
        "combined": "testAnimation_both.gif",
        "he_only": "testAnimation_HE.gif", 
        "iqid_full": "testAnimation_iQID_full.gif"
      }
    },
    
    "metadata": {
      "base_path": "",
      "iqid_data": "iqid_data.txt",
      "readme": "readme.docx",
      "metadata_tju": "metadata_TJU.csv",
      "quantitative_notes": "quantitative_notes.docx"
    },
    
    "file_patterns": {
      "he_images": {
        "standard": "*.jpg",
        "tiff": "*.tif",
        "png": "*.png",
        "sequential": "*_Lower_*.tif, *_Upper_*.tif"
      },
      "iqid_raw": "0_*_iqid_event_image.tif",
      "iqid_aligned": "mBq_corr_*.tif",
      "iqid_segmented": "1_segmented/mBq_*.tif",
      "general_tiff": "*.tif",
      "general_tiff_stack": "*.tiff"
    },
    
    "tissue_types": ["Kidney", "Tumor"],
    
    "sample_structure": {
      "kidney_pattern": "D*M*(P*)_[LR]",
      "tumor_pattern": "D* M* tumor *um",
      "day_pattern": "D[0-9]+",
      "mouse_pattern": "M[0-9]+",
      "position_pattern": "P[0-9]*"
    },
    
    "expected_subdirs": {
      "raw_events": "0_raw_iqid_events/",
      "segmented": "1_segmented/",
      "aligned": "2_aligned/",
      "lr_images": "LR_ims/",
      "visualization": "Visualization/"
    }
  },
  
  "storage_policy": {
    "enforce_readonly": true,
    "note": "All processing results are stored in local workflow directories",
    "readonly_sources": "UCSF data directories are read-only - no files written there",
    "output_base": "outputs/",
    "base_output_dir": "outputs/unified_analysis/",
    "intermediate_dir": "intermediate/unified/",
    "logs_dir": "logs/",
    "reports_dir": "reports/"
  },
  
  "iqid_alignment": {
    "preprocessing": {
      "gaussian_blur_sigma": 1.0,
      "normalize": true,
      "enhance_contrast": false,
      "background_correction": true,
      "flat_field_correction": false,
      "noise_reduction": true,
      "outlier_removal": true
    },
    
    "alignment": {
      "method": "phase_correlation",
      "reference_frame": "middle",
      "max_shift": 50,
      "subpixel_precision": true,
      "edge_handling": "crop",
      "interpolation": "bilinear"
    },
    
    "quality_control": {
      "correlation_threshold": 0.7,
      "outlier_threshold": 2.5,
      "max_displacement": 10.0,
      "frame_quality_check": true
    }
  },
  
  "he_iqid_coregistration": {
    "he_preprocessing": {
      "stain_normalization": true,
      "artifact_removal": true,
      "resolution_matching": true,
      "target_resolution_um": 10.0,
      "enhance_contrast": true,
      "color_deconvolution": false
    },
    
    "registration": {
      "method": "feature_based",
      "initial_scale_factor": 1.0,
      "max_iterations": 200,
      "convergence_threshold": 1e-5,
      "use_mutual_information": true,
      "feature_detector": "SIFT",
      "registration_type": "rigid"
    },
    
    "segmentation": {
      "tissue_segmentation_method": "otsu",
      "activity_segmentation_method": "adaptive",
      "min_tissue_area": 500,
      "min_activity_area": 100,
      "morphological_operations": true,
      "hole_filling": true
    },
    
    "analysis": {
      "quantify_activity_per_tissue": true,
      "calculate_dose_metrics": true,
      "statistical_analysis": true,
      "roi_analysis": true,
      "correlation_analysis": true
    }
  },
  
  "output": {
    "iqid_alignment": {
      "save_aligned_stack": true,
      "save_alignment_metrics": true,
      "save_quality_report": true,
      "create_visualizations": true,
      "output_format": "numpy",
      "save_intermediate": true,
      "create_timestamped_outputs": true
    },
    
    "he_iqid_coregistration": {
      "save_registered_images": true,
      "save_segmentation_results": true,
      "save_quantitative_data": true,
      "export_csv": true,
      "output_format": "tiff",
      "create_overlay_images": true
    },
    
    "unified": {
      "create_comprehensive_report": true,
      "save_processing_metadata": true,
      "create_summary_plots": true
    }
  },
  
  "visualization": {
    "create_alignment_plots": true,
    "create_registration_plots": true,
    "create_analysis_plots": true,
    "save_segmentation_masks": true,
    "colormap_iqid": "viridis",
    "colormap_he": "rgb",
    "colormap_overlay": "jet",
    "plot_dpi": 300,
    "plot_colorbars": true,
    "figure_size": [12, 8]
  },
  
  "performance": {
    "parallel_processing": true,
    "max_workers": 4,
    "chunk_size": 10,
    "memory_limit_gb": 16,
    "enable_caching": true
  },
  
  "logging": {
    "level": "INFO",
    "log_file": "logs/unified_workflow.log",
    "console_output": true,
    "detailed_timing": true,
    "log_data_paths": true
  }
}
